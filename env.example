# ============================================
# TILDA UPDATE CHECKER - КОНФИГУРАЦИЯ
# ============================================

# ============================================
# OpenAI API Configuration (ОПЦИОНАЛЬНО)
# ============================================
# Для LLM анализа изменений в коде
# Получить ключ: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-your-api-key-here
OPENAI_MODEL=gpt-5  # Рекомендуется GPT-5 для детального анализа (было: gpt-4o-mini)
OPENAI_TEMPERATURE=0.3
OPENAI_MAX_TOKENS=3000  # Увеличено для подробных анонсов с примерами (было: 500)

# Стоимость GPT-5: ~$0.011 за анализ, ~$10-11/месяц при 1000 анализов
# Качество: в 20-30x лучше gpt-4o-mini для детального анализа кода

# ============================================
# Telegram Bot Configuration (ОПЦИОНАЛЬНО)
# ============================================
# Для отправки уведомлений в Telegram группы/каналы
#
# КАК ПОЛУЧИТЬ:
# 1. Создайте бота через @BotFather в Telegram
#    - Отправьте команду: /newbot
#    - Следуйте инструкциям
#    - Получите токен вида: 123456789:ABCdefGHIjklMNOpqrsTUVwxyz
#
# 2. Получите Chat ID вашей группы/канала:
#    ВАРИАНТ А (для групп):
#      - Добавьте бота в группу
#      - Отправьте любое сообщение в группу
#      - Откройте: https://api.telegram.org/bot<ВАШ_ТОКЕН>/getUpdates
#      - Найдите "chat":{"id": -123456789} - это ваш Chat ID
#    
#    ВАРИАНТ Б (для каналов):
#      - Добавьте бота как администратора канала
#      - Отправьте пост в канал
#      - Откройте: https://api.telegram.org/bot<ВАШ_ТОКЕН>/getUpdates
#      - Найдите "chat":{"id": -100123456789} - это ваш Chat ID
#
# 3. Дайте боту права:
#    - Для групп: право на отправку сообщений
#    - Для каналов: права администратора с "Post Messages"

# Токен вашего Telegram бота (обязательно для Telegram уведомлений)
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz

# Chat ID основной группы/канала для анонсов (обязательно для Telegram уведомлений)
# Примеры:
#   Группа: -123456789
#   Канал: -100123456789
#   Приватный чат: 123456789
TELEGRAM_CHAT_ID=-123456789

# ============================================
# ДОПОЛНИТЕЛЬНЫЕ TELEGRAM НАСТРОЙКИ
# ============================================
# Если нужны уведомления в разные каналы/группы для разных типов сообщений:

# Chat ID для критических алертов (версии, 404 ошибки)
# Если не указано - используется TELEGRAM_CHAT_ID
TELEGRAM_ALERTS_CHAT_ID=-987654321

# Chat ID для ежедневных дайджестов
# Если не указано - используется TELEGRAM_CHAT_ID
TELEGRAM_DIGEST_CHAT_ID=-555666777

# Chat ID для Discovery Mode отчетов
# Если не указано - используется TELEGRAM_CHAT_ID
TELEGRAM_DISCOVERY_CHAT_ID=-111222333

# ============================================
# ТОПИКИ В TELEGRAM ГРУППАХ (ОПЦИОНАЛЬНО)
# ============================================
# Для групп с включенными топиками (Forum Topics) можно указать
# message_thread_id для отправки разных типов сообщений в разные топики
#
# КАК ПОЛУЧИТЬ THREAD ID:
# 1. Создайте супергруппу в Telegram
# 2. Включите топики: Настройки → Topics → Enable Topics
# 3. Создайте топики (например: General, Alerts, Digest, Discovery)
# 4. Отправьте сообщение в каждый топик
# 5. Скопируйте ссылку на сообщение: https://t.me/c/CHAT_ID/THREAD_ID/MESSAGE_ID
#    - CHAT_ID (без префикса -100): 3749682194 → для API: -1003749682194
#    - THREAD_ID: число между / (например, 2, 5, 6, 7)
#
# ВАЖНО: Thread ID работает ТОЛЬКО в группах. Если TELEGRAM_CHAT_ID
# не начинается с "-" (личный чат), thread_id будет игнорироваться.
#
# General топик всегда имеет thread_id = 1 (или первый созданный топик)

# Thread ID для основных сообщений (General топик)
# Если не указано - сообщения идут без указания топика
TELEGRAM_THREAD_ID=2

# Thread ID для критических алертов (Alerts топик)
# Если не указано - используется TELEGRAM_THREAD_ID
TELEGRAM_ALERTS_THREAD_ID=5

# Thread ID для дайджестов (Digest топик)
# Если не указано - используется TELEGRAM_THREAD_ID
TELEGRAM_DIGEST_THREAD_ID=6

# Thread ID для Discovery отчетов (Discovery топик)
# Если не указано - используется TELEGRAM_THREAD_ID
TELEGRAM_DISCOVERY_THREAD_ID=7

# ============================================
# ПРОЧИЕ TELEGRAM НАСТРОЙКИ
# ============================================

# Формат сообщений: Markdown или HTML
TELEGRAM_PARSE_MODE=Markdown

# Отключить уведомления о сообщении (silent mode)
TELEGRAM_DISABLE_NOTIFICATION=false

# ============================================
# Database Configuration
# ============================================
DATABASE_PATH=data/tilda_checker.db

# ============================================
# Monitoring Configuration
# ============================================
# Интервал проверки изменений (в секундах)
# 3600 = 1 час (рекомендуется)
# 1800 = 30 минут
# 7200 = 2 часа
TILDA_CHECK_INTERVAL=3600

# Интервал для Discovery Mode (в секундах)
# По умолчанию: еженедельно (понедельник 9:00) - настраивается в main.py
# Для ручного запуска используйте: python main.py --discover
DISCOVERY_MODE_ENABLED=true

# Автоматическая миграция версий
# true - автоматически мигрировать на новые версии (с учетом приоритета)
# false - только уведомлять о новых версиях
AUTO_MIGRATION_ENABLED=true

# Задержка миграции по приоритетам (в секундах)
# CRITICAL - немедленно, HIGH - 1 час, MEDIUM - 24 часа, LOW - 7 дней
MIGRATION_DELAY_HIGH=3600
MIGRATION_DELAY_MEDIUM=86400
MIGRATION_DELAY_LOW=604800

# Порог 404 ошибок для критического алерта
CONSECUTIVE_404_THRESHOLD=3

# ID канарейка-страниц для мониторинга page-bundle файлов (через запятую)
# Page-bundle — скомпилированный CSS/JS всех блоков конкретной страницы Tilda.
# Обычно такие файлы мусорные, но канарейка-страница со всеми блоками
# даёт дополнительный сигнал изменений.
# Пример: CANARY_PAGE_IDS=107307226,107307227
CANARY_PAGE_IDS=

# ============================================
# Logging Configuration
# ============================================
# Уровни: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO
LOG_FILE=logs/tilda_checker.log

# Максимальный размер лог файла (в МБ) перед ротацией
LOG_MAX_SIZE_MB=10

# Количество backup лог файлов
LOG_BACKUP_COUNT=5

# ============================================
# Advanced Settings (необязательные)
# ============================================

# HTTP таймаут для запросов к CDN (в секундах)
HTTP_TIMEOUT=30

# Максимальное количество попыток при ошибке загрузки
HTTP_MAX_RETRIES=3

# Задержка между попытками (в секундах)
HTTP_RETRY_DELAY=5

# User-Agent для HTTP запросов
HTTP_USER_AGENT=TildaUpdateChecker/1.0

# Максимальный размер файла для анализа (в МБ)
MAX_FILE_SIZE_MB=10

# Порог изменений для LLM анализа (в символах)
# Если изменений больше этого порога - отправляется сокращенная версия
LLM_ANALYSIS_THRESHOLD=5000

# ============================================
# DOCKER CONFIGURATION
# ============================================
# Настройки для запуска в Docker контейнере
# Эти переменные автоматически устанавливаются в docker-compose.yml
# Но вы можете переопределить их здесь

# Python настройки для Docker
# PYTHONUNBUFFERED=1 - вывод логов в реальном времени (без буферизации)
PYTHONUNBUFFERED=1

# PYTHONDONTWRITEBYTECODE=1 - не создавать .pyc файлы
PYTHONDONTWRITEBYTECODE=1

# Временная зона для контейнера
# Примеры: Europe/Moscow, America/New_York, Asia/Tokyo, UTC
TZ=Europe/Moscow

# ============================================
# DOKPLOY DEPLOYMENT SETTINGS
# ============================================
# Настройки для деплоя через Dokploy
# Эти переменные устанавливаются в Dokploy Web UI
# в разделе Environment Variables

# Режим работы приложения в production
# Production рекомендации:
# - LOG_LEVEL=INFO (не DEBUG)
# - AUTO_MIGRATION_ENABLED=true
# - TILDA_CHECK_INTERVAL=3600 (1 час)
# - Настроить TELEGRAM для критических алертов

# ============================================
# VOLUME PATHS (для Docker)
# ============================================
# Пути к данным внутри контейнера
# В Dokploy настройте volumes:
#   Host Path → Container Path
#   /path/on/host/data → /app/data
#   /path/on/host/logs → /app/logs

# DATABASE_PATH и LOG_FILE уже настроены выше
# Они автоматически работают с volumes

# ============================================
# NOTES / ПРИМЕЧАНИЯ
# ============================================
# 
# 1. Обязательные параметры для базовой работы:
#    - Никаких! Система работает без API ключей
#
# 2. Для LLM анализа требуется:
#    - OPENAI_API_KEY
#
# 3. Для Telegram уведомлений требуется:
#    - TELEGRAM_BOT_TOKEN
#    - TELEGRAM_CHAT_ID
#
# 4. Все остальные параметры - опциональные
#
# 5. Для production деплоя рекомендуется:
#    - Настроить Telegram для критических алертов
#    - Включить AUTO_MIGRATION_ENABLED=true
#    - LOG_LEVEL=INFO (для production) или DEBUG (для отладки)
#
# 6. Для Docker/Dokploy деплоя:
#    - Скопируйте этот файл в .env: cp env.example .env
#    - Заполните OPENAI_API_KEY и TELEGRAM credentials
#    - В Dokploy добавьте .env через Environment Variables
#    - Настройте volumes для /app/data и /app/logs
#    - Включите auto-deploy on push для автоматических обновлений
#
# ============================================
